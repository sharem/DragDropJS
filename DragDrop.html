<!DOCTYPE html>    
<head>
    <meta charset="utf-8">
    <title>fabric.js-simple text display</title>
	
	<!-- Get version 1.1.0 of Fabric.js from CDN -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/1.1.0/fabric.all.min.js" ></script>

	<!-- Get the highest 1.X version of jQuery from CDN. Required for ready() function. -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script> 

<body>
		<!-- A canvas tag is required or 
			 Fabric.js doesn't know where to draw. -->
		<canvas id="c" class="upper-canvas " style="border: 1px solid rgb(170, 170, 170); position: absolute; width: 500px; height: 500px; left: 0px; top: 0px; -moz-user-select: none; cursor: default;" width="500" height="500"></canvas>
</body>

<script>
	// Place script tags at the bottom of the page.
	// That way progressive page rendering and 
	// downloads are not blocked.

	// Run only when HTML is loaded and 
	// DOM properly initialized
	$(function() {
  var canvas = new fabric.Canvas('c');
  fabric.Object.prototype.transparentCorners = false;

  var rect1 = new fabric.Rect({
    width: 100, height: 100, left: 100, top: 350,
    fill: 'red',
	selectable: false
  });

  var rect2 = new fabric.Rect({
    width: 100, height: 100, left: 400, top: 350,
    fill: 'red',
	selectable: false
  });
  
  var rect3 = new fabric.Rect({
    width: 100, height: 100, left: 100, top: 100,
    fill: 'blue'
  });

  var rect4 = new fabric.Rect({
    width: 100, height: 100, left: 175, top: 250,
    fill: 'green'
  });
  
  // var positions = [rect1, rect2]; 
  // Positions MAP => key = [Object, ocuppied?(true/false)]
  var positions = {};
  positions[1] = [rect1, false];
  positions[2] = [rect2, false];

  canvas.add(rect1, rect2, rect3, rect4);
  canvas.on({
    'object:moving': onChange,
	  'object:modified': goToPosition,
  });

  function onChange(options) {
    options.target.setCoords();
    canvas.forEachObject(function(obj) {
      if (obj === options.target) return;
      obj.setOpacity(options.target.intersectsWithObject(obj) ? 0.5 : 1);
    });
  }
  
  function goToPosition(options) {
    for (var pos in positions){
      // get the position object
      var position = positions[pos][0];
      var ocuppied = positions[pos][1];
      // if the object was previously occupying a position, free 
      // that position
      if (ocuppied) positions[pos][1] = false;
		  // check if the object intersects a position
      if (options.target.intersectsWithObject(position)) {
        // check if the position is already filled with another object
        if (!(ocuppied)) {
            // if it's not filled with another object,
            // automaticaly fill the position with the objects
            options.target.setLeft(position.getLeft());
            options.target.setTop(position.getTop());
            positions[pos][1] = true;
        } else {
          alert("There's another object in this position! :/");
        };
      };
	 };
  }
})();

</script>
		
</head>


</html>